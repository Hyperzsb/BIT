# 4. Stock Matching System (多项式相乘) <font color=Red>(Buggy)</font>

**Description:**

在股票交易中，股民可以通过各种手段将委托送到股票交易所。每个委托主要说明了股民身份、买卖的股票、价格和数量。交易的规则是价格优先、时间优先，即出的价格最高的人先买，出的价格最低的人先卖。两个委托只有价格合适时才能成交，未成交的委托按价格顺序放在撮合队列中。每个股票有两个撮合队列：买队列和卖队列。只有当买委托的价格高于等于卖委托的价格，两个委托才可以成交，成交价取两个委托价格的平均值，成交量取两个委托数量的最小值。委托可以是完全成交或部分成交，部分成交的委托保留在撮合队列中继续交易。试利用单链表作为存放委托的数据结构（撮合队列），编写一模拟股票交易的程序，该程序有以下几个功能：

1. 委托申请：

输入：每个委托包括四个数据项，股票编码（ 4 位数字）、价格（浮点数）、数量（整数）、买 / 卖（ B/S ）

输出： a. 程序为每个委托产生一个唯一的序号（ %04d ），该序号从 1 开始； b. 每笔成交包括：成交价格（ %6.1f ）、成交量（ %4d ）、新的委托序号（ %04d ）、匹配的委托序号（ %04d ）。

2. 查询未成交的委托：

输入：股票编码

输出：按撮合队列中委托的顺序，分别输出该股票未成交的委托，每个输出的委托包括：委托序号（ %04d ）、 股票编码 （ %04d ） 、 价格（ %6.1f ）、数量（ %4d ）、 B/S （买 / 卖 )

3. 委托撤消：

输入：要撤消的委托号。

输出：若成功，显示该委托信息，其中委托包括数据项：委托序号、股票编码、价格、数量、 B/S （买 / 卖 ) ；否则显示“ not found ”失败信息。

注意：

1、当查询未成交委托时，如果没有委托，仍要输出“buy orders:”或“sell orders: ”。

2、输入的委托price>=0。

3、输入的委托quantity>=0，当接受一个新的委托时，首先根据委托的股票编码和价格与现有队列中的委托进行撮合，若撮合后有剩余的数量没有得到满足（即**quantity>0**），则将新委托插入到相应队列中。

委托输入格式： 1 股票编码 价格 数量 买卖

查询输入格式： 2 股票编码

委托撤销： .3 委托号

退出： 0

**Example:**

- Input:

```
1 9990 8 1000 s
1 0001 9 500 s
1 0001 8 200 s
1 0001 12 1000 s
1 0001 10 1000 b
2 0001
0
```

- Output:

```
orderid: 0001
orderid: 0002
orderid: 0003
orderid: 0004
orderid: 0005
deal--price:   9.0  quantity: 200  buyorder:0005  sellorder:0003
deal--price:   9.5  quantity: 500  buyorder:0005  sellorder:0002
buy orders:
orderid: 0005, stockid:0001, price:   10.0, quantity:  300, b/s: b
sell orders:
orderid: 0004, stockid:0001, price:   12.0, quantity: 1000, b/s: s
```
